FROM node:8.11.2-alpine AS build
WORKDIR /usr/src/app
COPY ./frontend/package*.json ./
RUN npm i
COPY ./frontend/ .
ARG base_url
RUN sed -i 's|https://backend_url|'${base_url}'|g' /usr/src/app/src/app/services/token-interceptor.service.ts

RUN npm run build

FROM nginx:1.17.1-alpine
WORKDIR /usr/share/nginx/html
COPY --from=build /usr/src/app/dist/eSchool .
COPY ./frontend/nginx.conf /etc/nginx/conf.d/default.conf
